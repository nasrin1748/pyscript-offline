const e=Promise.withResolvers.bind(Promise);const t="",{toString:r}={},{keys:n}=Object,s=e=>{const n=typeof e;if("object"!==n||!e)return[0,n];const s=r.call(e).slice(8,-1);switch(s){case"Array":return[1,t];case"Object":return[2,t];case"Date":return[3,t];case"RegExp":return[4,t];case"Map":return[5,t];case"Set":return[6,t];case"DataView":return[1,s]}return s.includes("Array")?[1,s]:s.includes("Error")?[7,s]:[2,s]},o=([e,t])=>0===e&&("function"===t||"symbol"===t),a=(e,{json:t,lossy:r}={})=>{const a=[];return((e,t,r,a)=>{const c=(e,t)=>{const n=a.push(e)-1;return r.set(t,n),n},u=a=>{if(r.has(a))return r.get(a);let[i,l]=s(a);switch(i){case 0:{let t=a;switch(l){case"bigint":i=8,t=a.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);t=null;break;case"undefined":return c([-1],a)}return c([i,t],a)}case 1:{if(l){let e=a;return"DataView"===l?e=new Uint8Array(a.buffer):"ArrayBuffer"===l&&(e=new Uint8Array(a)),c([l,[...e]],a)}const e=[],t=c([i,e],a);for(const t of a)e.push(u(t));return t}case 2:{if(l)switch(l){case"BigInt":return c([l,a.toString()],a);case"Boolean":case"Number":case"String":return c([l,a.valueOf()],a)}if(t&&"toJSON"in a)return u(a.toJSON());const r=[],f=c([i,r],a);for(const t of n(a))!e&&o(s(a[t]))||r.push([u(t),u(a[t])]);return f}case 3:return c([i,a.toISOString()],a);case 4:{const{source:e,flags:t}=a;return c([i,{source:e,flags:t}],a)}case 5:{const t=[],r=c([i,t],a);for(const[r,n]of a)(e||!o(s(r))&&!o(s(n)))&&t.push([u(r),u(n)]);return r}case 6:{const t=[],r=c([i,t],a);for(const r of a)!e&&o(s(r))||t.push(u(r));return r}}const{message:f}=a;return c([i,{name:l,message:f}],a)};return u})(!(t||r),!!t,new Map,a)(e),a},{stringify:c}=JSON,u={json:!0,lossy:!0};const i=(l=e=>c(a(e,u)),({byteOffset:e=0}={})=>(t,r)=>{const n=l(t),s=n.length,o=2*s+e;r.byteLength<o&&r.grow(o);const a=new Uint16Array(r,e,s);for(let e=0;e<s;e++)a[e]=n.charCodeAt(e);return s});var l;const f=[],g=new WeakSet,p=(...e)=>(g.add(e),e),{assign:y,create:h}=Object;let m="coincident-",d=!0;try{new SharedArrayBuffer(4,{maxByteLength:8}),m+=crypto.randomUUID()}catch(e){d=!1,m+=Math.random().toString(36).substring(2)}const w={byteOffset:2*Int32Array.BYTES_PER_ELEMENT,useUTF16:!0,circular:!0},b=(e,t,r)=>{const n="then"!==t;return n&&(e[t]=r),n},S="InstallTrigger"in globalThis?m:"",{notify:A}=Atomics,M=e=>e;var O=t=>{const r=t?.transform,n=(t?.encoder||i)(w),s=!1!==t?.transfer;class o extends globalThis.Worker{constructor(t,o){const{port1:a,port2:c}=new MessageChannel,[u,i]=((t=e=>e)=>{const r=new Map;let n=0;return[()=>{let s;do{s=t(n++)}while(r.has(s));const o=e();return r.set(s,o),[s,o.promise]},(e,t,n)=>{const s=r.get(e);r.delete(e),n?s?.reject(n):s?.resolve(t)}]})(M),l=new Map,p=h(null);let m="";super(t,y({type:"module"},o)).proxy=new Proxy(p,{get:(e,t)=>{if("then"===t)return;let n=l.get(t);return n||l.set(t,n=(...e)=>{const n=((e,t)=>{let r=f;return e&&g.has(t.at(-1)||f)&&(r=t.pop(),g.delete(r)),r})(s,e),[o,c]=u();return a.postMessage([o,t,r?e.map(r):e],n),((e,t)=>{if(m){const r=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${m}() awaiting proxy.${t}() ?`);e=e.then((e=>(clearTimeout(r),e)),(e=>(clearTimeout(r),Promise.reject(e))))}return e})(c,t)}),n},set:b}),super.postMessage(S,[c]),d&&S&&super.addEventListener("message",(e=>{const{data:t}=e;t?.ID===S&&((e=>{e.stopImmediatePropagation(),e.preventDefault()})(e),a.onmessage(t))})),a.onmessage=async({data:e})=>{const t=e[0],s=typeof t;if("number"===s)i.apply(null,e);else if(m=e[1],await(async(e,t,r)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=r?r(n):n,e[2]=null}catch(t){e[2]=t}})(e,p,r),m="","string"===s)a.postMessage(e);else{const r=e[2]||e[1];t[1]=void 0===r?0:n(r,t.buffer),t[0]=1,A(t,0)}}}}return{Worker:o,native:d,transfer:p}};export{O as default};
