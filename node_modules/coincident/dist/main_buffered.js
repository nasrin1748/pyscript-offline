const e=Promise.withResolvers.bind(Promise);const{assign:t,create:n}=Object;let s="coincident-",r=!0;try{new SharedArrayBuffer(4,{maxByteLength:8}),s+=crypto.randomUUID()}catch(e){r=!1,s+=Math.random().toString(36).substring(2)}const a=2*Int32Array.BYTES_PER_ELEMENT,o={byteOffset:a,useUTF16:!0,circular:!0},i=(e,t,n)=>{const s="then"!==t;return s&&(e[t]=n),s};var c=256===new DataView(new Uint16Array([256]).buffer).getUint16(0,!0),l=0,f=1,u=2,b=3,g=4,y=5,p=10,m=20,h=30,d=40,w=50,k=51,U=52,E=53,T=54,A=55,M=64,S=70,I=100,x=101,O=102,j=103,v=104,B=105,L=255;const{getPrototypeOf:P}=Object,D=e=>{const t=typeof e;switch(t){case"function":case"undefined":return"";case"object":return null===e?"null":"object";default:return t}},{isArray:N}=Array,{isView:F}=ArrayBuffer,{isInteger:R,isFinite:W}=Number,{entries:_}=Object,z=(e,t)=>{t<256?(q(e,G+2),e.setUint8(G++,k),e.setUint8(G++,t)):t<65536?(q(e,G+3),e.setUint8(G++,E),e.setUint16(G,t,c),G+=2):t<4294967296?(q(e,G+5),e.setUint8(G++,A),e.setUint32(G,t,c),G+=4):V(e,t)},V=(e,t)=>{q(e,G+9),e.setUint8(G++,M),e.setFloat64(G,t,c),G+=8},$=(e,t,n)=>{const s=t.get(n);return"number"==typeof s?(q(e,G+1),e.setUint8(G++,l),z(e,s),!0):(t.set(n,G),!1)},C=(e,t,n,s)=>{q(e,G+10+n*s),e.setUint8(G++,t),z(e,n)},J=e=>{q(e,G+1),e.setUint8(G++,L)},Y=(e,t)=>{q(e,G+1),e.setUint8(G++,t)},q=(e,t)=>{H<t&&(H+=t+32767,e.buffer.grow(H))};let G=0,H=G;const K=(e,t,n,s=D(n))=>{switch(s){case"null":Y(e,b);break;case"object":if($(e,t,n))break;switch(!0){case N(n):{const s=n.length;C(e,p,s,1);for(let r=0;r<s;r++)K(e,t,n[r]);break}case F(n):{const{BYTES_PER_ELEMENT:s,buffer:r,byteOffset:a,length:o}=n;if(Y(e,d),K(e,t,(e=>{for(;!(e.name in globalThis);)e=P(e);return e.name})(n.constructor),"string"),z(e,a),z(e,o!==(r.byteLength-a)/s?o:0),$(e,t,r))break;n=r}case n instanceof ArrayBuffer:{const t=n.byteLength,s=n.resizable?n.maxByteLength:0;if(C(e,h,t,1),z(e,s),t){q(e,G+=t);const s=new Uint8Array(n,0,t);new Uint8Array(e.buffer).set(s,G-t)}break}case n instanceof Date:Y(e,I),z(e,+n);break;case n instanceof Map:C(e,x,n.size,1);for(const[s,r]of n){const n=D(s),a=D(r);n&&a?(K(e,t,s,n),K(e,t,r,a)):J(e)}break;case n instanceof Set:C(e,O,n.size,1);for(const s of n){const n=D(s);n?K(e,t,s,n):J(e)}break;case n instanceof RegExp:Y(e,v),K(e,t,n.source,"string"),K(e,t,n.flags,"string");break;case n instanceof Error:Y(e,B),K(e,t,n.name,"string"),K(e,t,n.message,"string"),K(e,t,n.stack,"string");break;default:{if("toJSON"in n){const s=n.toJSON();if(s===n){Y(e,m),z(e,0);break}if($(e,t,n=s))break}const s=_(n),r=s.length;C(e,m,r,1);for(let n=0;n<r;n++){const r=s[n],a=D(r[1]);a?(K(e,t,r[0],"string"),K(e,t,r[1],a)):J(e)}break}}break;case"boolean":Y(e,n?u:f);break;case"number":R(n)?((e,t)=>{-128<=t&&t<128?(q(e,G+2),e.setUint8(G++,w),e.setInt8(G++,t)):-32768<=t&&t<32768?(q(e,G+3),e.setUint8(G++,U),e.setInt16(G,t,c),G+=2):-2147483648<=t&&t<2147483648?(q(e,G+5),e.setUint8(G++,T),e.setInt32(G,t,c),G+=4):V(e,t)})(e,n):W(n)?V(e,n):Y(e,b);break;case"string":{if($(e,t,n))break;const s=n.length;C(e,y,s,2);for(let t=0;t<s;t++)e.setUint16(G,n.charCodeAt(t),c),G+=2;break}case"bigint":q(e,G+9),e.setUint8(G++,S),e.setBigInt64(G,n,c),G+=8;break;case"symbol":{const s=(e=>{const t=String(e).slice(7,-1);return t.startsWith("Symbol.")||Symbol.keyFor(e)?t:""})(n);if(s){Y(e,j),K(e,t,s,"string");break}}case"":Y(e,g);break;default:throw new Error(`Unsupported type: ${s}`)}},Q=e=>(t,n)=>((e,t,{byteOffset:n=0}={})=>{const s=G=n;return H=t.byteLength,K(new DataView(t),new Map,e),G-s})(t,n,e),X=[],Z=new WeakSet,ee=(...e)=>(Z.add(e),e),te="InstallTrigger"in globalThis?s:"",{notify:ne}=Atomics,se=e=>e;var re=s=>{const a=s?.transform,c=(s?.encoder||Q)(o),l=!1!==s?.transfer;class f extends globalThis.Worker{constructor(s,o){const{port1:f,port2:u}=new MessageChannel,[b,g]=((t=e=>e)=>{const n=new Map;let s=0;return[()=>{let r;do{r=t(s++)}while(n.has(r));const a=e();return n.set(r,a),[r,a.promise]},(e,t,s)=>{const r=n.get(e);n.delete(e),s?r?.reject(s):r?.resolve(t)}]})(se),y=new Map,p=n(null);let m="";super(s,t({type:"module"},o)).proxy=new Proxy(p,{get:(e,t)=>{if("then"===t)return;let n=y.get(t);return n||y.set(t,n=(...e)=>{const n=((e,t)=>{let n=X;return e&&Z.has(t.at(-1)||X)&&(n=t.pop(),Z.delete(n)),n})(l,e),[s,r]=b();return f.postMessage([s,t,a?e.map(a):e],n),((e,t)=>{if(m){const n=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${m}() awaiting proxy.${t}() ?`);e=e.then((e=>(clearTimeout(n),e)),(e=>(clearTimeout(n),Promise.reject(e))))}return e})(r,t)}),n},set:i}),super.postMessage(te,[u]),r&&te&&super.addEventListener("message",(e=>{const{data:t}=e;t?.ID===te&&((e=>{e.stopImmediatePropagation(),e.preventDefault()})(e),f.onmessage(t))})),f.onmessage=async({data:e})=>{const t=e[0],n=typeof t;if("number"===n)g.apply(null,e);else if(m=e[1],await(async(e,t,n)=>{try{const s=await t[e[1]].apply(null,e[2]);e[1]=n?n(s):s,e[2]=null}catch(t){e[2]=t}})(e,p,a),m="","string"===n)f.postMessage(e);else{const n=e[2]||e[1];t[1]=void 0===n?0:c(n,t.buffer),t[0]=1,ne(t,0)}}}}return{Worker:f,native:r,transfer:ee}};export{re as default};
