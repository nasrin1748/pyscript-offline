const e=Promise.withResolvers.bind(Promise);var t=(t=e=>e)=>{const r=new Map;let n=0;return[()=>{let s;do{s=t(n++)}while(r.has(s));const o=e();return r.set(s,o),[s,o.promise]},(e,t,n)=>{const s=r.get(e);r.delete(e),n?s?.reject(n):s?.resolve(t)}]};const r="940beb37",n="="+r,s="-"+r,o=n+"-ws",a=s+"-ws",{getPrototypeOf:c}=Object,u=e=>{for(;!(e.name in globalThis);)e=c(e);return e.name},l=e=>{const t=typeof e;switch(t){case"function":case"undefined":return"";case"object":return null===e?"null":"object";default:return t}},{assign:i,create:f}=Object;let p="coincident-",y=!0;try{new SharedArrayBuffer(4,{maxByteLength:8}),p+=crypto.randomUUID()}catch(e){y=!1,p+=Math.random().toString(36).substring(2)}const b=2*Int32Array.BYTES_PER_ELEMENT,g={byteOffset:b,useUTF16:!0,circular:!0},h=(e,t,r)=>{const n="then"!==t;return n&&(e[t]=r),n};var d={ref:0,array:1,object:2,number:3,string:4,true:5,false:6,null:7,buffer:8,view:9,symbol:10,date:11,bigint:12,undefined:13,map:14,set:15,regexp:16,error:17};const{defineProperty:w}=Object,m=e=>{switch(e[v++]){case d.array:{const t=e[v++],r=[];e[v-2]=r;for(let n=0;n<t;n++)r[n]=m(e);return r}case d.object:{const t=e[v++],r={};e[v-2]=r;for(let n=0;n<t;n++)r[m(e)]=m(e);return r}case d.string:{const t=e[v++];return e[v-2]=t,t}case d.number:return e[v++];case d.true:return!0;case d.false:return!1;case d.null:return null;case d.undefined:return;case d.bigint:return BigInt(e[v++]);case d.buffer:{const t=e[v++],r=e[v++],n=[t];r&&n.push({maxByteLength:r});const s=new ArrayBuffer(...n);e[v-3]=s;const o=new Uint8Array(s,0,t);for(let r=0;r<t;r++)o[r]=e[v++];return s}case d.view:{const t=e[v++],r=e[v++],n=e[v++],s=v-4,o=[m(e),r];n&&o.push(n);const a=new globalThis[t](...o);return e[s]=a,a}case d.date:{const t=new Date(e[v++]);return e[v-2]=t,t}case d.map:{const t=e[v++],r=new Map;e[v-2]=r;for(let n=0;n<t;n++){const t=m(e),n=m(e);void 0!==t&&r.set(t,n)}return r}case d.set:{const t=e[v++],r=new Set;e[v-2]=r;for(let n=0;n<t;n++){const t=m(e);void 0!==t&&r.add(t)}return r}case d.regexp:{const t=e[v++],r=e[v++],n=new RegExp(t,r);return e[v-3]=n,n}case d.error:{const t=globalThis[e[v++]]||Error,r=e[v++],n=e[v++],s=new t(r,{cause:e[v++]});return e[v-5]=w(s,"stack",{value:n}),s}case d.symbol:return(t=e[v++]).startsWith("Symbol.")?Symbol[t.slice(t.indexOf(".")+1)]:Symbol.for(t);case d.ref:return e[e[v++]];default:throw new TypeError(`Unknown type: ${e[v-1]}`)}var t},{parse:k}=JSON;let v=0;const S=e=>{return t=k(e),v=0,t.length?m(t):void 0;var t};var T=e=>({byteOffset:t=0}={})=>(r,n)=>{const s=e(r),o=s.length,a=2*o+t;n.byteLength<a&&n.grow(a);const c=new Uint16Array(n,t,o);for(let e=0;e<o;e++)c[e]=s.charCodeAt(e);return o};const{isArray:x}=Array,{isView:E}=ArrayBuffer,{stringify:M}=JSON,A=(e,t,r)=>{const n=t.get(r);return"number"==typeof n?(e.push(d.ref,n),!0):(t.set(r,e.length),!1)},O=(e,t,r,n=l(r))=>{switch(n){case"null":e.push(d.null);break;case"object":if(A(e,t,r))break;switch(!0){case x(r):{const n=r.length;e.push(d.array,n);for(let s=0;s<n;s++)O(e,t,r[s]);break}case E(r):{const{BYTES_PER_ELEMENT:n,buffer:s,byteOffset:o,length:a}=r;if(e.push(d.view,u(r.constructor),o,a!==(s.byteLength-o)/n?a:0),A(e,t,s))break;r=s}case r instanceof ArrayBuffer:{const t=r.byteLength,n=r.resizable?r.maxByteLength:0;if(e.push(d.buffer,t,n),t){const n=new Uint8Array(r,0,t);for(let t=0;t<n.length;t+=32767)e.push.apply(e,n.subarray(t,t+32767))}break}case r instanceof Date:e.push(d.date,+r);break;case r instanceof Map:{const n=e.push(d.map,0);let s=0;for(const[n,o]of r){const r=l(n),a=l(o);r&&a&&(O(e,t,n,r),O(e,t,o,a),s++)}e[n-1]=s;break}case r instanceof Set:{const n=e.push(d.set,0);let s=0;for(const n of r){const r=l(n);r&&(O(e,t,n,r),s++)}e[n-1]=s;break}case r instanceof RegExp:e.push(d.regexp,r.source,r.flags);break;case r instanceof Error:e.push(d.error,r.name,r.message,r.stack,r.cause);break;default:{if("toJSON"in r){const n=r.toJSON();if(n===r){e.push(d.object,0);break}if(A(e,t,r=n))break}const n=e.push(d.object,0);let s=0;for(const n in r){const o=r[n],a=l(o);a&&(O(e,t,n,"string"),O(e,t,o,a),s++)}e[n-1]=s;break}}break;case"boolean":e.push(r?d.true:d.false);break;case"string":if(A(e,t,r))break;e.push(d.string,r);break;case"bigint":e.push(d.bigint,r.toString());break;case"symbol":{const t=(e=>{const t=String(e).slice(7,-1);return t.startsWith("Symbol.")||Symbol.keyFor(e)?t:""})(r);if(t){e.push(d.symbol,t);break}}case"":e.push(d.undefined);break;default:e.push(d[n],r)}},j=e=>M((e=>{const t=[];return O(t,new Map,e),t})(e)),P="destroy",{stringify:L}=JSON,W=T(L),B="array",R="bigint",N="boolean",U="function",D="null",I="number",J="object",$="string",F="symbol",_="undefined";var z={[B]:0,[R]:1,[N]:2,[U]:3,[D]:4,[I]:5,[J]:6,[$]:7,[F]:8,[_]:9,view:10};const{stringify:C}=JSON,K=T((e=>{switch(e[0]){case z.view:{const{constructor:t,buffer:r}=e[1];e[1]=[u(t),[...new Uint8Array(r)]];break}case z[R]:e[1]=e[1].toString()}return C(e)})),V=[],Y=new WeakSet,q=(...e)=>(Y.add(e),e),G="InstallTrigger"in globalThis?p:"",{notify:H}=Atomics,Q=e=>e;var X=e=>{const r=e?.transform,n=(e?.encoder||W)(g),s=!1!==e?.transfer;class o extends globalThis.Worker{constructor(e,o){const{port1:a,port2:c}=new MessageChannel,[u,l]=t(Q),p=new Map,b=f(null);let g="";super(e,i({type:"module"},o)).proxy=new Proxy(b,{get:(e,t)=>{if("then"===t)return;let n=p.get(t);return n||p.set(t,n=(...e)=>{const n=((e,t)=>{let r=V;return e&&Y.has(t.at(-1)||V)&&(r=t.pop(),Y.delete(r)),r})(s,e),[o,c]=u();return a.postMessage([o,t,r?e.map(r):e],n),((e,t)=>{if(g){const r=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${g}() awaiting proxy.${t}() ?`);e=e.then((e=>(clearTimeout(r),e)),(e=>(clearTimeout(r),Promise.reject(e))))}return e})(c,t)}),n},set:h}),super.postMessage(G,[c]),y&&G&&super.addEventListener("message",(e=>{const{data:t}=e;t?.ID===G&&((e=>{e.stopImmediatePropagation(),e.preventDefault()})(e),a.onmessage(t))})),a.onmessage=async({data:e})=>{const t=e[0],s=typeof t;if("number"===s)l.apply(null,e);else if(g=e[1],await(async(e,t,r)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=r?r(n):n,e[2]=null}catch(t){e[2]=t}})(e,b,r),g="","string"===s)a.postMessage(e);else{const r=e[2]||e[1];t[1]=void 0===r?0:n(r,t.buffer),t[0]=1,H(t,0)}}}}return{Worker:o,native:y,transfer:q}};const Z="destruct",ee=new Map;for(const e of Reflect.ownKeys(Symbol))typeof Symbol[e]===F&&(ee.set(Symbol[e],e),ee.set(e,Symbol[e]));const te=e=>ee.get(e)||`.${Symbol.keyFor(e)||""}`,re=new FinalizationRegistry((([e,t,r])=>{r&&console.debug(`%c${String(t)}`,"font-weight:bold","collected"),e(t)})),ne=Object.create(null),{addEventListener:se}=EventTarget.prototype,oe=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,...r){const n=r.at(0)?.invoke;if(n){let t=oe.get(this);t||(t=new Map,oe.set(this,t)),t.set(e,[].concat(n)),delete r[0].invoke}return se.call(this,e,t,...r)}});const{isArray:ae}=Array,{isView:ce}=ArrayBuffer;var ue=(e,t)=>{const{clear:r,drop:n,get:s,hold:o}=(()=>{const e=new Map,t=new Map;let r=0;return{clear:()=>{e.clear(),t.clear()},drop:r=>{const[n,s]=typeof r===I?[t,e]:[e,t],o=n.has(r);return o&&(s.delete(n.get(r)),n.delete(r)),o},get:e=>t.get(e),hold:n=>{if(!e.has(n)){let s;for(;t.has(s=r++););e.set(n,s),t.set(s,n)}return e.get(n)}}})(),a=new Map,c=e=>{a.delete(e),t(Z,e)},u=e=>{const t=typeof e;switch(t){case J:return null===e?[z[D],e]:e===globalThis?[z[J],null]:ae(e)?[z[B],o(e)]:ce(e)?[z.view,e]:[z[J],o(e)];case U:return[z[U],o(e)];case F:return[z[F],te(e)];default:return[z[t],e]}},l=([e,r])=>{switch(e){case z[J]:if(null===r)return globalThis;if(typeof r===I)return s(r);for(const e in r)r[e]=l(r[e]);return r;case z[B]:return typeof r===I?s(r):r.map(l);case z[U]:switch(typeof r){case I:return s(r);case $:{let e=a.get(r)?.deref();return e||(e=((e,t,{debug:r,handler:n,return:s,token:o=e}=ne)=>{const a=s||new Proxy(e,n||ne),c=[a,[t,e,!!r]];return!1!==o&&c.push(o),re.register(...c),a})(r,c,{token:!1,return:function(...e){return e.length&&e[0]instanceof Event&&(e=>{const{currentTarget:t,target:r,type:n}=e,s=oe.get(t||r)?.get(n);if(s)for(const t of s)e[t]()})(e[0]),t("apply",r,u(this),e.map(u)).then(l)}}),a.set(r,new WeakRef(e))),e}}case z[F]:return(e=>ee.get(e)||Symbol.for(e.slice(1)))(r);default:return r}},i=(e,t,r)=>u(e(t,...r.map(l))),f=t=>import(e(t)),p=new Set;return(e,t,...o)=>{if(e===P)r();else if(e===Z)p.has(t)||n(t);else{const r=Reflect[e],n=null==t?globalThis:s(t);switch(e){case"defineProperty":{const[e,t]=o.map(l);return u(r(n,e,t))}case"getOwnPropertyDescriptor":{const e=r(n,...o.map(l));if(e){const{get:t,set:r,value:n}=e;t&&(e.get=u(t)),r&&(e.set=u(r)),n&&(e.value=u(n))}return[z[e?J:_],e]}case"ownKeys":return[z[B],r(n).map(u)];case"get":if(null==t){const e="import"===o[0][1]?u(f):i(r,n,o);return p.add(e[1]),e}default:return i(r,n,o)}}return[z[_],void 0]}},le=e=>{let t=!1;const r=e?.import,o=e?.encoder||W,a=X({...e,encoder(e){const r=o(e),n=K(e);return(e,s)=>t?(t=!1,n(e,s)):r(e,s)}});class c extends a.Worker{constructor(e,o){const{proxy:a}=super(e,o),c=ue(o?.import||r||(e=>new URL(e,location.href)),a[s]);a[n]=function(...e){return t=!0,c.apply(this,e)}}terminate(){this.proxy[n](P),super.terminate()}}return{...a,Worker:c}};const{WebSocket:ie}=globalThis;var fe=e=>{const{ws:r}=e,n=le(e);class s extends n.Worker{#e=null;constructor(e,n){const{proxy:s}=super(e,n),[c,u]=t(Number),[l,i]=c(),f=s[a],p=this.#e=new ie(r);p.onerror=console.error,p.onclose=()=>super.terminate(),p.onopen=()=>{p.send(j([o])),u(l)},p.onmessage=async e=>{const t=S(e.data);if("number"==typeof t[0])u.apply(null,t);else{try{t[1]=await f(...t[1])}catch(e){t[1]=null,t[2]=e}p.send(j(t))}},s[o]=async(...e)=>{await i;const[t,r]=c();return p.send(j([t,e])),r}}terminate(){this.#e.close(),super.terminate()}}return{...n,Worker:s}};export{fe as default};
