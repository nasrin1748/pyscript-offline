const e="destroy";var t=e=>({byteOffset:t=0}={})=>(r,n)=>{const s=e(r),o=s.length,a=2*o+t;n.byteLength<a&&n.grow(a);const c=new Uint16Array(n,t,o);for(let e=0;e<o;e++)c[e]=s.charCodeAt(e);return o};const{stringify:r}=JSON,n=t(r),s="array",o="bigint",a="boolean",c="function",l="null",i="number",u="object",p="string",f="symbol",g="undefined",{getPrototypeOf:y}=Object,d=e=>{for(;!(e.name in globalThis);)e=y(e);return e.name};var h={[s]:0,[o]:1,[a]:2,[c]:3,[l]:4,[i]:5,[u]:6,[p]:7,[f]:8,[g]:9,view:10};const{stringify:m}=JSON,w=t((e=>{switch(e[0]){case h.view:{const{constructor:t,buffer:r}=e[1];e[1]=[d(t),[...new Uint8Array(r)]];break}case h[o]:e[1]=e[1].toString()}return m(e)})),b="940beb37",v="="+b,T="-"+b,S=Promise.withResolvers.bind(Promise);const M=[],k=new WeakSet,x=(...e)=>(k.add(e),e),{assign:E,create:P}=Object;let A="coincident-",O=!0;try{new SharedArrayBuffer(4,{maxByteLength:8}),A+=crypto.randomUUID()}catch(e){O=!1,A+=Math.random().toString(36).substring(2)}const R={byteOffset:2*Int32Array.BYTES_PER_ELEMENT,useUTF16:!0,circular:!0},L=(e,t,r)=>{const n="then"!==t;return n&&(e[t]=r),n},W="InstallTrigger"in globalThis?A:"",{notify:j}=Atomics,U=e=>e;var I=e=>{const t=e?.transform,r=(e?.encoder||n)(R),s=!1!==e?.transfer;class o extends globalThis.Worker{constructor(e,n){const{port1:o,port2:a}=new MessageChannel,[c,l]=((e=e=>e)=>{const t=new Map;let r=0;return[()=>{let n;do{n=e(r++)}while(t.has(n));const s=S();return t.set(n,s),[n,s.promise]},(e,r,n)=>{const s=t.get(e);t.delete(e),n?s?.reject(n):s?.resolve(r)}]})(U),i=new Map,u=P(null);let p="";super(e,E({type:"module"},n)).proxy=new Proxy(u,{get:(e,r)=>{if("then"===r)return;let n=i.get(r);return n||i.set(r,n=(...e)=>{const n=((e,t)=>{let r=M;return e&&k.has(t.at(-1)||M)&&(r=t.pop(),k.delete(r)),r})(s,e),[a,l]=c();return o.postMessage([a,r,t?e.map(t):e],n),((e,t)=>{if(p){const r=setTimeout(console.warn,3e3,`ðŸ’€ðŸ”’ - is proxy.${p}() awaiting proxy.${t}() ?`);e=e.then((e=>(clearTimeout(r),e)),(e=>(clearTimeout(r),Promise.reject(e))))}return e})(l,r)}),n},set:L}),super.postMessage(W,[a]),O&&W&&super.addEventListener("message",(e=>{const{data:t}=e;t?.ID===W&&((e=>{e.stopImmediatePropagation(),e.preventDefault()})(e),o.onmessage(t))})),o.onmessage=async({data:e})=>{const n=e[0],s=typeof n;if("number"===s)l.apply(null,e);else if(p=e[1],await(async(e,t,r)=>{try{const n=await t[e[1]].apply(null,e[2]);e[1]=r?r(n):n,e[2]=null}catch(t){e[2]=t}})(e,u,t),p="","string"===s)o.postMessage(e);else{const t=e[2]||e[1];n[1]=void 0===t?0:r(t,n.buffer),n[0]=1,j(n,0)}}}}return{Worker:o,native:O,transfer:x}};const B="destruct",D=new Map;for(const e of Reflect.ownKeys(Symbol))typeof Symbol[e]===f&&(D.set(Symbol[e],e),D.set(e,Symbol[e]));const $=e=>D.get(e)||`.${Symbol.keyFor(e)||""}`,F=new FinalizationRegistry((([e,t,r])=>{r&&console.debug(`%c${String(t)}`,"font-weight:bold","collected"),e(t)})),N=Object.create(null),{addEventListener:C}=EventTarget.prototype,J=new WeakMap;Reflect.defineProperty(EventTarget.prototype,"addEventListener",{value(e,t,...r){const n=r.at(0)?.invoke;if(n){let t=J.get(this);t||(t=new Map,J.set(this,t)),t.set(e,[].concat(n)),delete r[0].invoke}return C.call(this,e,t,...r)}});const{isArray:K}=Array,{isView:_}=ArrayBuffer;var z=(t,r)=>{const{clear:n,drop:o,get:a,hold:y}=(()=>{const e=new Map,t=new Map;let r=0;return{clear:()=>{e.clear(),t.clear()},drop:r=>{const[n,s]=typeof r===i?[t,e]:[e,t],o=n.has(r);return o&&(s.delete(n.get(r)),n.delete(r)),o},get:e=>t.get(e),hold:n=>{if(!e.has(n)){let s;for(;t.has(s=r++););e.set(n,s),t.set(s,n)}return e.get(n)}}})(),d=new Map,m=e=>{d.delete(e),r(B,e)},w=e=>{const t=typeof e;switch(t){case u:return null===e?[h[l],e]:e===globalThis?[h[u],null]:K(e)?[h[s],y(e)]:_(e)?[h.view,e]:[h[u],y(e)];case c:return[h[c],y(e)];case f:return[h[f],$(e)];default:return[h[t],e]}},b=([e,t])=>{switch(e){case h[u]:if(null===t)return globalThis;if(typeof t===i)return a(t);for(const e in t)t[e]=b(t[e]);return t;case h[s]:return typeof t===i?a(t):t.map(b);case h[c]:switch(typeof t){case i:return a(t);case p:{let e=d.get(t)?.deref();return e||(e=((e,t,{debug:r,handler:n,return:s,token:o=e}=N)=>{const a=s||new Proxy(e,n||N),c=[a,[t,e,!!r]];return!1!==o&&c.push(o),F.register(...c),a})(t,m,{token:!1,return:function(...e){return e.length&&e[0]instanceof Event&&(e=>{const{currentTarget:t,target:r,type:n}=e,s=J.get(t||r)?.get(n);if(s)for(const t of s)e[t]()})(e[0]),r("apply",t,w(this),e.map(w)).then(b)}}),d.set(t,new WeakRef(e))),e}}case h[f]:return(e=>D.get(e)||Symbol.for(e.slice(1)))(t);default:return t}},v=(e,t,r)=>w(e(t,...r.map(b))),T=e=>import(t(e)),S=new Set;return(t,r,...c)=>{if(t===e)n();else if(t===B)S.has(r)||o(r);else{const e=Reflect[t],n=null==r?globalThis:a(r);switch(t){case"defineProperty":{const[t,r]=c.map(b);return w(e(n,t,r))}case"getOwnPropertyDescriptor":{const t=e(n,...c.map(b));if(t){const{get:e,set:r,value:n}=t;e&&(t.get=w(e)),r&&(t.set=w(r)),n&&(t.value=w(n))}return[h[t?u:g],t]}case"ownKeys":return[h[s],e(n).map(w)];case"get":if(null==r){const t="import"===c[0][1]?w(T):v(e,n,c);return S.add(t[1]),t}default:return v(e,n,c)}}return[h[g],void 0]}},V=t=>{let r=!1;const s=t?.import,o=t?.encoder||n,a=I({...t,encoder(e){const t=o(e),n=w(e);return(e,s)=>r?(r=!1,n(e,s)):t(e,s)}});class c extends a.Worker{constructor(e,t){const{proxy:n}=super(e,t),o=z(t?.import||s||(e=>new URL(e,location.href)),n[T]);n[v]=function(...e){return r=!0,o.apply(this,e)}}terminate(){this.proxy[v](e),super.terminate()}}return{...a,Worker:c}};export{V as default};
